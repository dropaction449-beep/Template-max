{% comment %}
  Section: Video Slider - ELLES L'ADORENT
  
  Settings disponibles:
  - section.settings.heading: Titre de la section
  - section.settings.videos: Liste des vidéos à afficher
{% endcomment %}

<div class="product-info__block-item" data-block-id="liquid_zkyjhC" data-block-type="liquid">
  <div class="product-info__liquid">
    <div class="section-{{ section.id }}-settings">
      
      {% if section.settings.heading != blank %}
        <div class="video-heading-{{ section.id }}">
          <h1>{{ section.settings.heading }}</h1>
        </div>
      {% endif %}

      <div class="video-slider-{{ section.id }} swiper">
        <div class="swiper-wrapper" id="swiper-wrapper-{{ section.id }}" aria-live="polite">
          
          {% for video in section.settings.videos %}
            <div class="video-slide-{{ section.id }} swiper-slide" data-video-index="{{ forloop.index0 }}">
              <div class="video-slide-video-{{ section.id }}" id="video-container-{{ section.id }}-{{ forloop.index0 }}">
                
                {% if video != blank %}
                  <video 
                    id="video-{{ section.id }}-{{ forloop.index0 }}"
                    src="{{ video | video_url }}"
                    muted
                    playsinline
                    loop
                    preload="metadata"
                    poster="{{ video | image_url: width: 300 }}"
                    loading="lazy"
                    data-video-element>
                  </video>
                {% endif %}
                
              </div>

              <div class="video-icon-{{ section.id }}" data-play-icon>
                <svg viewBox="0 0 70 70">
                  <g opacity="0.55">
                    <rect x="1" y="1" width="68" height="68" rx="34"></rect>
                  </g>
                  <path d="M35,1A34,34,0,1,1,1,35,34,34,0,0,1,35,1m0-1h0A35,35,0,0,0,0,35H0A35,35,0,0,0,35,70h0A35,35,0,0,0,70,35h0A35,35,0,0,0,35,0Z" fill="#fff"></path>
                  <path d="M45.48,34.39,27.42,24a.7.7,0,0,0-1.05.6V45.43a.7.7,0,0,0,1.05.6L45.48,35.61A.7.7,0,0,0,45.48,34.39Z" fill="#fff"></path>
                </svg>
              </div>
              
            </div>
          {% endfor %}
          
        </div>
        
        <button class="video-btn-prev-{{ section.id }}" aria-label="Previous slide" aria-controls="swiper-wrapper-{{ section.id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
            <rect width="50" height="50" fill="#fff" opacity="0"></rect>
            <path d="M17.39,7.5A2.27,2.27,0,0,1,19,8.17L34.22,23.39a2.28,2.28,0,0,1,0,3.22L19,41.83a2.28,2.28,0,1,1-3.23-3.23L29.38,25,15.78,11.4a2.29,2.29,0,0,1,0-3.23A2.25,2.25,0,0,1,17.39,7.5Z"></path>
          </svg>
        </button>
        
        <button class="video-btn-next-{{ section.id }}" aria-label="Next slide" aria-controls="swiper-wrapper-{{ section.id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
            <rect width="50" height="50" fill="#fff" opacity="0"></rect>
            <path d="M17.39,7.5A2.27,2.27,0,0,1,19,8.17L34.22,23.39a2.28,2.28,0,0,1,0,3.22L19,41.83a2.28,2.28,0,1,1-3.23-3.23L29.38,25,15.78,11.4a2.29,2.29,0,0,1,0-3.23A2.25,2.25,0,0,1,17.39,7.5Z"></path>
          </svg>
        </button>
        
        <span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>
      </div>
      
    </div>
    <div id="ss-product-videos"></div>
  </div>
</div>

<style>
  .video-slider-{{ section.id }} {
    position: relative;
    overflow: hidden;
  }

  .video-slide-{{ section.id }} {
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .video-slide-{{ section.id }}.is-playing {
    transform: scale(1.05);
    z-index: 10;
  }

  .video-slide-video-{{ section.id }} video {
    width: 100%;
    height: auto;
    display: block;
  }

  .video-icon-{{ section.id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 5;
  }

  .video-slide-{{ section.id }}.is-playing .video-icon-{{ section.id }} {
    opacity: 0;
  }

  .video-icon-{{ section.id }} svg {
    width: 70px;
    height: 70px;
  }

  .video-btn-prev-{{ section.id }},
  .video-btn-next-{{ section.id }} {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 10px;
  }

  .video-btn-prev-{{ section.id }} {
    left: 10px;
    transform: translateY(-50%) rotate(180deg);
  }

  .video-btn-next-{{ section.id }} {
    right: 10px;
  }

  .video-btn-prev-{{ section.id }} svg,
  .video-btn-next-{{ section.id }} svg {
    width: 40px;
    height: 40px;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sectionId = '{{ section.id }}';
    const swiperEl = document.querySelector('.video-slider-' + sectionId);
    
    if (!swiperEl) return;

    // Initialiser Swiper
    const swiper = new Swiper('.video-slider-' + sectionId, {
      slidesPerView: 1,
      spaceBetween: 16,
      navigation: {
        nextEl: '.video-btn-next-' + sectionId,
        prevEl: '.video-btn-prev-' + sectionId,
      },
      breakpoints: {
        640: {
          slidesPerView: 2,
        },
        1024: {
          slidesPerView: 3,
        },
      },
    });

    // Gestion du clic sur les vidéos
    const slides = document.querySelectorAll('.video-slide-' + sectionId);
    
    slides.forEach(slide => {
      const video = slide.querySelector('[data-video-element]');
      const playIcon = slide.querySelector('[data-play-icon]');
      
      if (!video) return;

      slide.addEventListener('click', function() {
        const isPlaying = slide.classList.contains('is-playing');
        
        // Arrêter toutes les autres vidéos
        slides.forEach(otherSlide => {
          const otherVideo = otherSlide.querySelector('[data-video-element]');
          if (otherVideo && otherSlide !== slide) {
            otherVideo.pause();
            otherVideo.currentTime = 0;
            otherSlide.classList.remove('is-playing');
          }
        });

        // Toggle play/pause sur la vidéo cliquée
        if (isPlaying) {
          video.pause();
          slide.classList.remove('is-playing');
        } else {
          video.play();
          video.muted = false; // Activer le son au clic
          slide.classList.add('is-playing');
        }
      });

      // Gérer la fin de la vidéo
      video.addEventListener('ended', function() {
        slide.classList.remove('is-playing');
        video.currentTime = 0;
      });
    });
  });
</script>

{% schema %}
{
  "name": "Video Slider",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "ELLES L'ADORENT"
    },
    {
      "type": "video",
      "id": "video_1",
      "label": "Video 1"
    },
    {
      "type": "video",
      "id": "video_2",
      "label": "Video 2"
    },
    {
      "type": "video",
      "id": "video_3",
      "label": "Video 3"
    }
  ],
  "presets": [
    {
      "name": "Video Slider"
    }
  ]
}
{% endschema %}